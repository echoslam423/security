Zabbix报警机制
  什么是触发器（trigger）
    表达式，如内存不足300M，用户超过30个等
    当触发条件发生后，会导致一个触发事件
    触发事件会执行某个动作

  什么是动作（action）
    动作是触发器的条件被触发后所执行的行为
    可以是发送邮件、也可以是重启某个服务等
   
步骤一：创建触发器规则
  1）创建触发器
     通过Configuration--> Templates，找到我们之前创建的count.line.passwd模板，点击模板后面的triggers
        //配置->模版->创建触发器

  2）触发器表达式
     创建触发器时需要定义表达式，触发器表达式（Expression）是触发异常的条件，触发器表达式格式如下：
     {<server>:<key>.<function>(<parameter>)}<operator><constant>
     {主机：key.函数(参数)}<表达式>常数
    
    表达式的案例：
     a){web1:system.cpu.load[all,avg1].last(0)}>5             //0为最新数据
        如果web1主机最新的CPU平均负载值大于5，则触发器状态Problem
        
     b){vfs.fs.size[/,free].max(5m)}<10G                      //5m为最近5分钟
        根分区，最近5分钟的最大容量小于10G，则状态进入Problem
    
     c){vfs.file.cksum[/etc/passwd].diff(0)}>0                //0为最新数据
        最新一次校验/etc/passwd如果与上一次有变化，则状态进入Problem
        
      大多数函数使用秒作为参数，可以使用#来表示其他含义（具体参考表-1）。
      avg, count, last, min and max 等函数支持额外的第二个参数time_shift（时间偏移量），这个参数允许从过去一段时间内引用数据
      
  3）配置触发器
     触发器命名
     点击add(添加)，填写表达式：监控项为账户数量，最近300秒账户数量大于40  可以根据提示生成表达式
     选择触发器报警级别,Add创建该触发器
     
  
步骤二：设置邮件
  1）创建Media
    通过Administration（管理）-->Media Type（报警媒体类型）-->选择Email（邮件）
    设置邮件服务器信息，设置邮件服务器及邮件账户信息
    
  2)为用户添加Media
    在Administration（管理）-->Users（用户）中找到选择admin账户
    点击Admin账户后，在弹出的界面中选择Media（报警媒介）菜单-->点击Add(添加)报警媒介
    点击Add（添加）后，在Meida Type中填写报警类型，收件人，时间等信息
    
步骤三：创建Action动作
  1）Action动作
    Action（动作）是定义当触发器被触发时的时候，执行什么行为。
    通过Configuration（配置）-->Actions（动作）-->Create action（创建动作）
    
  2）配置Action动作的触发条件
    填写Action动作的名称，配置什么触发器被触发时会执行本Action动作,点击添加
    
  3）配置Action动作的具体行为
    配置动作的具体操作行为（发送信息或执行远程命令），无限次数发送邮件，60秒1次，发送给Admin用户
  
  4）测试效果
    在被监控主机创建账户（让账户数量大于26），然后登录监控端Web页面，在仪表盘中查看问题报警（需要等待一段时间）
    查看报警邮件，在监控服务器上使用mail命令查收报警邮件

Zabbix自动发现
  
  当Zabbix需要监控的设备越来越多，手动添加监控设备越来越有挑战，此时，可以考虑使用自动发现功能，
  自动添加被监控主机，实现自动批量添加一组监控主机功能。

  自动发现可以实现：
    自动发现、添加主机，自动添加主机到组；
    自动连接模板到主机，自动创建监控项目与图形等。

  自动发现（Discovery）流程：
    创建自动发现规则
    创建Action动作，说明发现主机后自动执行什么动作
    通过动作，执行添加主机，链接模板到主机等操作

  步骤一：自动发现规则
    1）创建自动发现规则
      通过Configuration（配置）-->Discovery（自动发现）-->Create discovery rule（创建发现规则）
      
    2）填写规则
      填写自动发现的IP范围（逗号隔开可以写多个），多久做一次自动发现（默认为1小时，仅实验修改为1m），
      配置检查的方式：Ping、HTTP、FTP、Agent的自定义key等检查
    
  步骤二：创建动作
    1）创建Action动作
      通过Configuration（配置）--> Action(动作)-->Actions Event source(事件源)：自动发现(Discovery)-->Create action（创建动作）
        
    2）配置Action动作具体行为
      点击操作（触发动作后要执行的操作指令），操作细节：添加主机到组，与模板链接（HTTP模板）
    
  步骤二：添加新的虚拟机
    1）创建新的虚拟机（启动HTTP服务器）
        创建一台新的主机，验证zabbix是否可以自动发现该主机，可以重新部署一台新的虚拟机
        （注意前面的课程，我们已经创建了虚拟机zabbixclient_web2，并且已经安装部署了Zabbix agent，
        如果没有该虚拟机或没有安装Agent，则需要前在zabbixclient_web2部署Agent），
        也可以将旧虚拟机的IP地址，临时修改为其他IP。

    2）验证结果
        登陆Zabbix服务器的Web页面，查看主机列表，确认新添加的主机是否被自动加入监控主机列表，
        是否自动绑定了监控模板。
